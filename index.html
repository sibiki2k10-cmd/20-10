<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Link Space üöÄ</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        :root { --glass-bg: rgba(255, 255, 255, 0.15); --glass-border: rgba(255, 255, 255, 0.2); --text: #fff; --accent: #ff0080; }
        * { box-sizing: border-box; font-family: 'Outfit', sans-serif; margin: 0; padding: 0; }
        body { background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab); background-size: 400% 400%; animation: gBG 15s ease infinite; color: var(--text); height: 100vh; overflow: hidden; display: flex; }
        @keyframes gBG { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
        
        .glass { background: var(--glass-bg); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); border: 1px solid var(--glass-border); border-radius: 20px; }
        
        /* SIDEBAR */
        .sidebar { width: 280px; height: 96vh; margin: 2vh 0 2vh 2vh; padding: 25px; display: flex; flex-direction: column; z-index: 100; transition: 0.3s; }
        .brand { font-size: 2rem; font-weight: 800; margin-bottom: 30px; display: flex; align-items: center; gap: 10px; }
        
        .folder-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; padding-right: 10px; }
        .folder-header span { font-size: 0.8rem; text-transform: uppercase; letter-spacing: 1px; opacity: 0.7; font-weight: bold; }
        .btn-add-folder { background: rgba(255,255,255,0.2); border: none; color: white; width: 25px; height: 25px; border-radius: 50%; cursor: pointer; transition: 0.2s; display: flex; align-items: center; justify-content: center; }
        .btn-add-folder:hover { background: var(--accent); transform: scale(1.1); }

        #folder-list { flex: 1; overflow-y: auto; padding-right: 5px; }
        #folder-list::-webkit-scrollbar { width: 4px; }
        #folder-list::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.3); border-radius: 4px; }

        .menu-item { padding: 12px 15px; margin-bottom: 5px; cursor: pointer; border-radius: 12px; transition: 0.2s; display: flex; align-items: center; gap: 10px; color: rgba(255,255,255,0.8); font-weight: 600; font-size: 0.95rem; }
        .menu-item:hover, .menu-item.active { background: rgba(255,255,255,0.25); color: white; transform: translateX(5px); }
        .folder-actions { margin-left: auto; display: flex; gap: 5px; opacity: 0; transition: 0.2s; }
        .menu-item:hover .folder-actions { opacity: 1; }
        .fa-icon-btn { font-size: 0.8rem; cursor: pointer; padding: 4px; transition: 0.2s; }
        .fa-icon-btn:hover { transform: scale(1.2); color: white; }
        .fa-icon-btn.del:hover { color: #ff6b81; }

        .f-icon { width: 20px; height: 20px; object-fit: contain; display: flex; align-items: center; justify-content: center; font-style: normal; }
        .f-icon img { width: 100%; height: 100%; border-radius: 4px; }

        .user-panel { margin-top: auto; padding-top: 20px; border-top: 1px solid rgba(255,255,255,0.15); display: flex; justify-content: space-between; align-items: center; }

        /* MAIN */
        .main { flex: 1; height: 100vh; overflow-y: auto; padding: 30px; }
        .top-bar { display: flex; gap: 15px; margin-bottom: 30px; align-items: center; }
        .search-box { flex: 1; position: relative; max-width: 400px; }
        .search-box input { width: 100%; padding: 12px 20px 12px 45px; border-radius: 30px; border: 2px solid rgba(255,255,255,0.2); background: rgba(255,255,255,0.1); color: white; outline: none; transition: 0.3s; }
        .search-box input:focus { background: rgba(255,255,255,0.25); border-color: rgba(255,255,255,0.5); }
        .search-icon { position: absolute; left: 15px; top: 50%; transform: translateY(-50%); opacity: 0.7; }
        .btn-add { background: linear-gradient(135deg, #fff, #f0f0f0); color: #e73c7e; border: none; padding: 12px 25px; border-radius: 30px; font-weight: bold; cursor: pointer; display: flex; align-items: center; gap: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); transition: 0.3s; }
        .btn-add:hover { transform: translateY(-3px); box-shadow: 0 8px 25px rgba(0,0,0,0.2); }

        /* GRID */
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 25px; padding-bottom: 50px; }
        .card { padding: 20px; transition: 0.3s; display: flex; flex-direction: column; overflow: hidden; position: relative; }
        .card:hover { transform: translateY(-5px); background: rgba(255,255,255,0.25); }
        .card-header { display: flex; gap: 15px; margin-bottom: 15px; }
        .card-icon { width: 50px; height: 50px; border-radius: 12px; object-fit: cover; background: white; padding: 2px; flex-shrink: 0; }
        .card-emoji { width: 50px; height: 50px; border-radius: 12px; background: rgba(255,255,255,0.2); display: flex; align-items: center; justify-content: center; font-size: 1.8rem; flex-shrink: 0; }
        .card-title { font-weight: 700; font-size: 1.1rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .card-tag { font-size: 0.75rem; background: rgba(255,255,255,0.2); padding: 3px 10px; border-radius: 15px; margin-top: 5px; display: inline-block; }
        .card-desc { font-size: 0.9rem; opacity: 0.8; margin-bottom: 15px; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; height: 2.8em; }
        .card-actions { margin-top: auto; display: flex; justify-content: space-between; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 10px; }
        .action-btn { background: none; border: none; color: rgba(255,255,255,0.7); cursor: pointer; width: 30px; height: 30px; border-radius: 50%; transition: 0.2s; }
        .action-btn:hover { color: white; background: rgba(255,255,255,0.2); }
        .action-btn.del:hover { color: #ff6b81; }

        /* MODAL */
        .overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); backdrop-filter: blur(10px); z-index: 999; display: flex; align-items: center; justify-content: center; opacity: 0; pointer-events: none; transition: 0.3s; }
        .overlay.active { opacity: 1; pointer-events: all; }
        .modal { background: white; color: #333; width: 450px; padding: 30px; border-radius: 20px; transform: scale(0.9); transition: 0.3s; max-width: 90vw; }
        .overlay.active .modal { transform: scale(1); }
        .inp-group { margin-bottom: 15px; }
        .inp-label { display: block; font-size: 0.85rem; font-weight: 600; margin-bottom: 5px; color: #666; }
        .inp { width: 100%; padding: 10px; border: 2px solid #eee; border-radius: 8px; font-size: 1rem; outline: none; }
        .inp:focus { border-color: var(--accent); }
        .btn-primary { width: 100%; padding: 12px; background: linear-gradient(135deg, #e73c7e, #ee7752); color: white; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; transition: 0.3s; }
        .btn-primary:hover { opacity: 0.9; transform: translateY(-2px); }
        #toast { position: fixed; bottom: 30px; right: 30px; background: rgba(0,0,0,0.9); color: white; padding: 12px 25px; border-radius: 30px; transform: translateY(100px); transition: 0.3s; z-index: 2000; }
        #toast.show { transform: translateY(0); }

        /* UPLOAD BTN */
        .btn-upload { background: #eee; border: none; padding: 0 15px; border-radius: 8px; cursor: pointer; transition: 0.2s; font-size: 1.2rem; color: #555; display: flex; align-items: center; justify-content: center; }
        .btn-upload:hover { background: #ddd; color: var(--accent); }

        @media (max-width: 768px) {
            .sidebar { position: fixed; left: -300px; height: 100vh; margin: 0; border-radius: 0; }
            .sidebar.open { left: 0; box-shadow: 10px 0 30px rgba(0,0,0,0.5); }
            .menu-toggle { display: block; font-size: 1.5rem; cursor: pointer; }
            .btn-add span { display: none; }
        }
        .menu-toggle { display: none; }
    </style>
</head>
<body>

    <div id="login-overlay" class="overlay active" style="z-index: 3000;">
        <div class="modal glass" style="background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.3); color: white; text-align: center;">
            <h1 style="margin-bottom: 5px;">Link Space ü™ê</h1>
            <p style="margin-bottom: 25px; opacity: 0.8;">Kho l∆∞u tr·ªØ v≈© tr·ª•</p>
            <input type="text" id="u" class="inp" placeholder="T√™n ƒëƒÉng nh·∫≠p" style="background:rgba(255,255,255,0.2); border:none; color:white; margin-bottom:10px;">
            <input type="password" id="p" class="inp" placeholder="M·∫≠t kh·∫©u" style="background:rgba(255,255,255,0.2); border:none; color:white; margin-bottom:20px;">
            <button class="btn-primary" onclick="app.login()">Kh·ªüi ƒë·ªông üöÄ</button>
            <p id="login-msg" style="color:#ff6b81; margin-top:10px; font-size:0.9rem"></p>
        </div>
    </div>

    <div class="sidebar glass" id="sidebar">
        <div class="brand"><i class="fas fa-meteor"></i> Link Space</div>
        <div class="menu-item active" onclick="app.filter('all', this)" style="margin-bottom: 20px;">
            <span class="f-icon">üåé</span> <span>T·∫•t c·∫£</span>
        </div>
        <div class="folder-header">
            <span>TH∆Ø M·ª§C</span>
            <button class="btn-add-folder" onclick="app.createFolder()" title="T·∫°o th∆∞ m·ª•c m·ªõi"><i class="fas fa-plus"></i></button>
        </div>
        <div id="folder-list">
            <p style="text-align:center; opacity:0.6; font-size:0.8rem">ƒêang t·∫£i...</p>
        </div>
        <div class="user-panel">
            <div style="display:flex; align-items:center; gap:10px">
                <div style="width:30px; height:30px; background:rgba(255,255,255,0.3); border-radius:50%; display:flex; align-items:center; justify-content:center"><i class="fas fa-user-astronaut"></i></div>
                <span id="user-display" style="font-weight:bold">Guest</span>
            </div>
            <button onclick="location.reload()" style="background:none; border:none; color:#ff6b81; cursor:pointer"><i class="fas fa-power-off"></i></button>
        </div>
    </div>

    <div class="main">
        <div class="top-bar">
            <i class="fas fa-bars menu-toggle" onclick="document.getElementById('sidebar').classList.add('open')"></i>
            <div class="search-box">
                <i class="fas fa-search search-icon"></i>
                <input type="text" id="search-inp" placeholder="T√¨m ki·∫øm link..." onkeyup="app.search()">
            </div>
            <button class="btn-add" onclick="app.openModal()"><i class="fas fa-plus"></i><span>Th√™m link</span></button>
        </div>
        <div onclick="document.getElementById('sidebar').classList.remove('open')" style="position:fixed; top:0; left:0; right:0; bottom:0; z-index:90; display:none;" id="sidebar-overlay"></div>
        <div class="grid" id="grid"></div>
    </div>

    <div id="modal-overlay" class="overlay">
        <div class="modal">
            <h2 id="modal-title" style="margin-top:0;">Th√™m Link M·ªõi</h2>
            
            <div class="inp-group">
                <label class="inp-label">ƒê∆∞·ªùng d·∫´n Website</label>
                <div style="display:flex; gap:10px">
                    <input type="text" id="inp-url" class="inp" placeholder="URL (https://...)" onchange="app.fetchMeta()">
                    <button onclick="app.fetchMeta()" class="btn-primary" style="width:50px; display:flex; align-items:center; justify-content:center">‚ö°</button>
                </div>
            </div>

            <div class="inp-group" style="display:flex; gap:10px">
                <div style="flex:1">
                     <label class="inp-label">Ti√™u ƒë·ªÅ</label>
                     <input type="text" id="inp-title" class="inp" placeholder="Ti√™u ƒë·ªÅ trang">
                </div>
                <div style="flex:1">
                    <label class="inp-label">Icon (Link/Emoji)</label>
                    <div style="display:flex; gap:5px">
                        <input type="text" id="inp-icon" class="inp" placeholder="D√°n link ho·∫∑c...">
                        <input type="file" id="up-file" hidden onchange="app.uploadIcon()">
                        <button class="btn-upload" onclick="document.getElementById('up-file').click()" title="T·∫£i ·∫£nh l√™n"><i class="fas fa-cloud-upload-alt"></i></button>
                    </div>
                </div>
            </div>

            <div class="inp-group">
                <label class="inp-label">Th∆∞ m·ª•c</label>
                <select id="inp-cate" class="inp"></select>
            </div>

            <div class="inp-group">
                <textarea id="inp-desc" class="inp" rows="2" placeholder="M√¥ t·∫£ ng·∫Øn..."></textarea>
            </div>
            <input type="hidden" id="inp-row">
            
            <div style="display:flex; justify-content:flex-end; gap:10px; margin-top:20px;">
                <button onclick="document.getElementById('modal-overlay').classList.remove('active')" style="background:#eee; color:#333; padding:10px 20px; border:none; border-radius:10px; cursor:pointer">H·ªßy</button>
                <button onclick="app.saveLink()" id="btn-save" class="btn-primary" style="width:auto">L∆∞u l·∫°i</button>
            </div>
        </div>
    </div>

    <div id="toast">Th√¥ng b√°o</div>

    <script>
        // --- THAY LINK API C·ª¶A B·∫†N V√ÄO ƒê√ÇY ---
        const API = 'https://script.google.com/macros/s/AKfycbwBriN_3F_gvhohT9j0_ao1wgUbj1h1QI928HJs6LP8WzdDqgT4rp43jFh7I-5Q69c6/exec'; 

        const app = {
            links: [], folders: [], userMDD: '', isEdit: false,

            login: function() {
                const u = document.getElementById('u').value, p = document.getElementById('p').value;
                const btn = document.querySelector('#login-overlay button'); btn.innerText = "Connecting..."; btn.disabled = true;
                const fd = new FormData(); fd.append('action', 'login'); fd.append('user', u); fd.append('pass', p);
                fetch(API, {method:'POST', body:fd}).then(r=>r.json()).then(res=>{
                    if(res.status=='success'){
                        this.userMDD = res.mdd;
                        document.getElementById('user-display').innerText = u;
                        document.getElementById('login-overlay').classList.remove('active');
                        this.initData();
                    } else { btn.innerText = "Kh·ªüi ƒë·ªông üöÄ"; btn.disabled = false; document.getElementById('login-msg').innerText = "Sai th√¥ng tin!"; }
                });
            },

            initData: function() { this.loadFolders().then(() => this.loadLinks()); },

            // --- FOLDER LOGIC ---
            loadFolders: function() {
                return fetch(API + '?action=getFolders&mdd=' + this.userMDD).then(r=>r.json()).then(res=>{
                    this.folders = res; this.renderFolders();
                });
            },

            renderFolders: function() {
                const list = document.getElementById('folder-list'); list.innerHTML = "";
                if(this.folders.length == 0) list.innerHTML = `<p style="text-align:center; opacity:0.6; font-size:0.8rem; margin-top:10px">Ch∆∞a c√≥ th∆∞ m·ª•c.<br>B·∫•m + ƒë·ªÉ t·∫°o.</p>`;
                
                this.folders.forEach(f => {
                    let iconHtml = f.icon && f.icon.startsWith('http') ? `<img src="${f.icon}">` : (f.icon || 'üìÅ');
                    list.innerHTML += `
                        <div class="menu-item" onclick="app.filter('${f.name}', this)">
                            <div style="display:flex; align-items:center; gap:10px; overflow:hidden;">
                                <span class="f-icon">${iconHtml}</span>
                                <span style="white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">${f.name}</span>
                            </div>
                            <div class="folder-actions">
                                <i class="fas fa-pen fa-icon-btn" onclick="event.stopPropagation(); app.editFolder(${f.row}, '${f.name}', '${f.icon||''}')"></i>
                                <i class="fas fa-trash fa-icon-btn del" onclick="event.stopPropagation(); app.delFolder(${f.row}, '${f.name}')"></i>
                            </div>
                        </div>
                    `;
                });
            },

            createFolder: function() {
                const name = prompt("Nh·∫≠p t√™n th∆∞ m·ª•c:"); if(!name) return;
                const icon = prompt("Nh·∫≠p Icon (Emoji/Link/Ho·∫∑c ƒë·ªÉ tr·ªëng t·∫£i ·∫£nh sau):", "üìÅ");
                if(this.folders.some(f => f.name.toLowerCase() == name.toLowerCase())) return alert("T√™n tr√πng!");
                this.folders.push({name: name, icon: icon, row: 9999}); this.renderFolders();
                const fd = new FormData(); fd.append('action', 'createFolder'); fd.append('name', name); fd.append('icon', icon); fd.append('mdd', this.userMDD);
                fetch(API, {method:'POST', body:fd}).then(()=> this.loadFolders());
                this.toast(`ƒê√£ t·∫°o: ${name}`);
            },

            editFolder: function(row, oldName, oldIcon) {
                const newName = prompt("T√™n th∆∞ m·ª•c m·ªõi:", oldName); if(newName === null) return;
                const newIcon = prompt("Icon m·ªõi (Emoji/Link):", oldIcon); if(newIcon === null) return;
                const fd = new FormData(); fd.append('action', 'editFolder'); fd.append('row', row); fd.append('name', newName); fd.append('icon', newIcon);
                fetch(API, {method:'POST', body:fd}).then(()=> { this.loadFolders(); this.loadLinks(); });
                this.toast("ƒêang c·∫≠p nh·∫≠t...");
            },

            delFolder: function(row, name) {
                if(!confirm(`X√≥a th∆∞ m·ª•c "${name}"?`)) return;
                this.folders = this.folders.filter(f => f.row != row); this.renderFolders();
                const fd = new FormData(); fd.append('action', 'deleteFolder'); fd.append('row', row);
                fetch(API, {method:'POST', body:fd});
                this.toast("ƒê√£ x√≥a th∆∞ m·ª•c");
            },

            // --- UPLOAD LOGIC ---
            uploadIcon: function() {
                const file = document.getElementById('up-file').files[0];
                if(!file) return;
                
                const reader = new FileReader();
                const btn = document.querySelector('.btn-upload');
                const orgHtml = btn.innerHTML;
                btn.innerHTML = "<i class='fas fa-spinner fa-spin'></i>"; btn.disabled = true;

                reader.onload = function(e) {
                    const base64 = e.target.result;
                    const fd = new FormData();
                    fd.append('action', 'uploadImage');
                    fd.append('data', base64);
                    
                    fetch(API, {method: 'POST', body: fd})
                    .then(r => r.json())
                    .then(res => {
                        btn.innerHTML = orgHtml; btn.disabled = false;
                        if(res.status == 'success') {
                            document.getElementById('inp-icon').value = res.url;
                            app.toast("Upload th√†nh c√¥ng!");
                        } else {
                            alert("L·ªói upload: " + res.error);
                        }
                    })
                    .catch(() => { btn.innerHTML = orgHtml; btn.disabled = false; alert("L·ªói k·∫øt n·ªëi"); });
                };
                reader.readAsDataURL(file);
            },

            // --- LINK LOGIC ---
            loadLinks: function() {
                document.getElementById('grid').innerHTML = '<p style="text-align:center; width:100%; color:white;">ƒêang t·∫£i d·ªØ li·ªáu...</p>';
                fetch(API + '?action=getLinks&mdd=' + this.userMDD).then(r=>r.json()).then(res=>{
                    this.links = res; this.renderLinks(this.links);
                });
            },

            renderLinks: function(list) {
                const grid = document.getElementById('grid'); grid.innerHTML = "";
                if(list.length==0) { grid.innerHTML = '<p style="text-align:center; width:100%; opacity:0.7">Ch∆∞a c√≥ link n√†o.</p>'; return;}
                list.forEach(i => {
                    const iconVal = i[7];
                    let iconHtml = (iconVal && iconVal.startsWith('http')) 
                        ? `<img src="${iconVal}" class="card-icon" onerror="this.src='https://cdn-icons-png.flaticon.com/512/1006/1006771.png'">`
                        : `<div class="card-emoji">${iconVal || 'üîó'}</div>`;

                    grid.innerHTML += `
                        <div class="card glass">
                            <div class="card-header">
                                ${iconHtml}
                                <div style="flex:1; overflow:hidden">
                                    <div class="card-title" title="${i[1]}">${i[1]}</div>
                                    <span class="card-tag">${i[3] || 'Chung'}</span>
                                </div>
                            </div>
                            <div class="card-desc">${i[6] || ''}</div>
                            <div class="card-actions">
                                <a href="${i[2]}" target="_blank" class="action-btn" title="M·ªü"><i class="fas fa-external-link-alt"></i></a>
                                <div style="display:flex; gap:5px">
                                    <button onclick="app.copyLink('${i[2]}')" class="action-btn"><i class="fas fa-copy"></i></button>
                                    <button onclick="app.editModal(${i[8]})" class="action-btn"><i class="fas fa-pen"></i></button>
                                    <button onclick="app.delLink(${i[8]})" class="action-btn del"><i class="fas fa-trash"></i></button>
                                </div>
                            </div>
                        </div>
                    `;
                });
            },

            filter: function(cate, el) {
                document.querySelectorAll('.menu-item').forEach(e=>e.classList.remove('active'));
                el.classList.add('active');
                if(cate=='all') { this.renderLinks(this.links); return; }
                this.renderLinks(this.links.filter(x=> x[3] == cate));
            },

            search: function() {
                const k = document.getElementById('search-inp').value.toLowerCase();
                this.renderLinks(this.links.filter(x => String(x[1]).toLowerCase().includes(k) || String(x[2]).toLowerCase().includes(k)));
            },

            openModal: function() {
                this.isEdit = false; document.getElementById('modal-title').innerText = "Th√™m Link M·ªõi";
                ['inp-url','inp-title','inp-desc','inp-icon','up-file'].forEach(id=> { 
                    const el = document.getElementById(id); if(el) el.value=""; 
                });
                this.populateCate(); document.getElementById('modal-overlay').classList.add('active');
            },

            editModal: function(row) {
                const item = this.links.find(x=>x[8]==row); if(!item) return;
                this.isEdit = true; document.getElementById('modal-title').innerText = "C·∫≠p Nh·∫≠t Link";
                document.getElementById('inp-row').value = row;
                document.getElementById('inp-title').value = item[1];
                document.getElementById('inp-url').value = item[2];
                document.getElementById('inp-desc').value = item[6];
                document.getElementById('inp-icon').value = item[7];
                this.populateCate();
                document.getElementById('inp-cate').value = item[3];
                document.getElementById('modal-overlay').classList.add('active');
            },

            populateCate: function() {
                const sel = document.getElementById('inp-cate'); sel.innerHTML = "";
                if(this.folders.length === 0) sel.innerHTML = "<option value='Chung'>Chung</option>";
                else this.folders.forEach(f => sel.innerHTML += `<option value="${f.name}">${f.name}</option>`);
            },

            fetchMeta: function() {
                const url = document.getElementById('inp-url').value; if(url.length < 5) return;
                const btn = document.querySelector('.inp-group button'); btn.innerHTML = "...";
                const fd = new FormData(); fd.append('action', 'fetchMeta'); fd.append('url', url);
                fetch(API, {method:'POST', body:fd}).then(r=>r.json()).then(res=>{
                    btn.innerHTML = "‚ö°";
                    if(res.title){
                        document.getElementById('inp-title').value = res.title;
                        document.getElementById('inp-desc').value = res.description;
                        document.getElementById('inp-icon').value = res.icon;
                        this.toast("ƒê√£ l·∫•y th√¥ng tin!");
                    }
                });
            },

            saveLink: function() {
                const u = document.getElementById('inp-url').value, t = document.getElementById('inp-title').value;
                if(!u || !t) return alert("Thi·∫øu URL ho·∫∑c Ti√™u ƒë·ªÅ");
                
                const btn = document.getElementById('btn-save'); btn.innerText = "L∆∞u..."; btn.disabled = true;
                const fd = new FormData();
                fd.append('mdd', this.userMDD); fd.append('url', u); fd.append('title', t);
                fd.append('category', document.getElementById('inp-cate').value);
                fd.append('desc', document.getElementById('inp-desc').value);
                fd.append('icon', document.getElementById('inp-icon').value);
                
                if(this.isEdit) { fd.append('action', 'editLink'); fd.append('row', document.getElementById('inp-row').value); }
                else fd.append('action', 'addLink');

                fetch(API, {method:'POST', body:fd}).then(()=>{
                    this.toast("ƒê√£ l∆∞u th√†nh c√¥ng!");
                    document.getElementById('modal-overlay').classList.remove('active');
                    btn.innerText = "L∆∞u l·∫°i"; btn.disabled = false;
                    this.loadLinks();
                });
            },

            delLink: function(r) {
                if(!confirm("X√≥a link n√†y?")) return;
                this.links = this.links.filter(x=>x[8]!=r); this.renderLinks(this.links);
                const fd = new FormData(); fd.append('action', 'deleteLink'); fd.append('row', r);
                fetch(API, {method:'POST', body:fd});
            },

            copyLink: function(t) { navigator.clipboard.writeText(t); this.toast("ƒê√£ copy link!"); },
            toast: function(m) { const t=document.getElementById('toast'); t.innerText=m; t.classList.add('show'); setTimeout(()=>t.classList.remove('show'),3000); }
        };
        
        document.querySelector('.menu-toggle').onclick = () => { document.getElementById('sidebar').classList.add('open'); document.getElementById('sidebar-overlay').style.display = 'block'; }
        document.getElementById('sidebar-overlay').onclick = () => { document.getElementById('sidebar').classList.remove('open'); document.getElementById('sidebar-overlay').style.display = 'none'; }
    </script>
</body>
</html>
