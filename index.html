<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Link Space üöÄ</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --glass-bg: rgba(255, 255, 255, 0.15);
            --glass-border: rgba(255, 255, 255, 0.2);
            --glass-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.2);
            --text-color: #ffffff;
            --card-hover: rgba(255, 255, 255, 0.25);
            --accent: #ff0080;
        }

        * { box-sizing: border-box; font-family: 'Outfit', sans-serif; }

        body {
            margin: 0; padding: 0;
            background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
            color: var(--text-color);
            height: 100vh;
            overflow: hidden;
            display: flex;
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* --- GLASSMOPHISM CLASSES --- */
        .glass {
            background: var(--glass-bg);
            box-shadow: var(--glass-shadow);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
        }

        /* --- LAYOUT --- */
        .sidebar {
            width: 260px;
            height: 96vh;
            margin: 2vh 0 2vh 2vh;
            padding: 20px;
            display: flex;
            flex-direction: column;
            transition: 0.3s;
            z-index: 100;
        }

        .main {
            flex: 1;
            height: 100vh;
            overflow-y: auto;
            padding: 30px;
            position: relative;
        }

        /* --- SIDEBAR COMPONENTS --- */
        .brand {
            font-size: 1.8rem;
            font-weight: 800;
            margin-bottom: 40px;
            display: flex; align-items: center; gap: 10px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .menu-item {
            padding: 14px 20px;
            margin-bottom: 8px;
            cursor: pointer;
            border-radius: 12px;
            transition: 0.3s;
            display: flex; align-items: center; gap: 15px;
            color: rgba(255,255,255,0.7);
            font-weight: 600;
        }
        .menu-item:hover, .menu-item.active {
            background: rgba(255,255,255,0.2);
            color: white;
            transform: translateX(5px);
        }
        
        .user-panel {
            margin-top: auto;
            padding-top: 20px;
            border-top: 1px solid rgba(255,255,255,0.1);
            display: flex; align-items: center; justify-content: space-between;
        }

        /* --- TOP BAR & SEARCH --- */
        .top-bar {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 30px;
        }
        
        .search-box {
            position: relative;
            width: 300px;
        }
        .search-box input {
            width: 100%;
            padding: 12px 20px 12px 45px;
            border-radius: 30px;
            border: none;
            outline: none;
            background: rgba(255,255,255,0.15);
            color: white;
            backdrop-filter: blur(5px);
            transition: 0.3s;
        }
        .search-box input::placeholder { color: rgba(255,255,255,0.6); }
        .search-box input:focus { background: rgba(255,255,255,0.25); box-shadow: 0 0 15px rgba(255,255,255,0.1); }
        .search-icon {
            position: absolute; left: 15px; top: 50%; transform: translateY(-50%);
            color: rgba(255,255,255,0.6);
        }

        .btn-add {
            background: white; color: #e73c7e;
            border: none; padding: 12px 25px;
            border-radius: 30px;
            font-weight: bold; cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            transition: 0.3s;
            display: flex; align-items: center; gap: 8px;
        }
        .btn-add:hover { transform: translateY(-3px) scale(1.05); box-shadow: 0 8px 25px rgba(0,0,0,0.3); }

        /* --- GRID CARDS --- */
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 25px;
            padding-bottom: 80px;
        }

        .card {
            padding: 20px;
            position: relative;
            transition: 0.3s;
            display: flex; flex-direction: column;
            overflow: hidden;
        }
        .card:hover {
            transform: translateY(-5px);
            background: var(--card-hover);
        }
        
        .card-header { display: flex; gap: 15px; margin-bottom: 12px; }
        .card-icon { width: 48px; height: 48px; border-radius: 12px; object-fit: cover; background: white; padding: 2px; }
        .card-title { font-weight: 700; font-size: 1.1rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 160px; }
        .card-tag { font-size: 0.75rem; background: rgba(255,255,255,0.2); padding: 2px 10px; border-radius: 20px; display: inline-block; margin-top: 4px; }
        
        .card-desc {
            font-size: 0.85rem; color: rgba(255,255,255,0.7);
            margin-bottom: 15px;
            display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;
            height: 2.6em; line-height: 1.3em;
        }

        .card-actions {
            margin-top: auto;
            display: flex; justify-content: space-between;
            border-top: 1px solid rgba(255,255,255,0.1);
            padding-top: 12px;
        }
        .action-btn {
            background: none; border: none; color: rgba(255,255,255,0.6);
            cursor: pointer; font-size: 1rem; transition: 0.2s;
            width: 30px; height: 30px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
        }
        .action-btn:hover { background: rgba(255,255,255,0.2); color: white; }
        .action-btn.del:hover { background: #ff4757; color: white; }

        /* --- LOGIN & MODAL --- */
        .overlay-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6); backdrop-filter: blur(15px);
            z-index: 999; display: flex; align-items: center; justify-content: center;
            opacity: 0; pointer-events: none; transition: 0.3s;
        }
        .overlay-screen.active { opacity: 1; pointer-events: all; }

        .modal-box {
            background: white; color: #333;
            width: 450px; padding: 30px;
            border-radius: 20px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.3);
            transform: scale(0.9); transition: 0.3s;
        }
        .overlay-screen.active .modal-box { transform: scale(1); }

        .inp-group { margin-bottom: 15px; }
        .inp-control {
            width: 100%; padding: 12px; border: 1px solid #ddd;
            border-radius: 8px; font-size: 1rem; outline: none; transition: 0.2s;
        }
        .inp-control:focus { border-color: var(--accent); box-shadow: 0 0 0 3px rgba(255, 0, 128, 0.1); }
        
        .btn-primary {
            width: 100%; padding: 12px; border: none; border-radius: 8px;
            background: linear-gradient(45deg, #e73c7e, #ee7752);
            color: white; font-weight: bold; cursor: pointer; font-size: 1rem;
            transition: 0.3s;
        }
        .btn-primary:hover { opacity: 0.9; transform: translateY(-2px); }

        /* --- TOAST --- */
        #toast {
            position: fixed; bottom: 30px; right: 30px;
            background: rgba(0,0,0,0.8); color: white;
            padding: 12px 25px; border-radius: 50px;
            display: flex; align-items: center; gap: 10px;
            transform: translateY(100px); transition: 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            z-index: 1000;
        }
        #toast.show { transform: translateY(0); }

        /* MOBILE */
        .menu-toggle { display: none; color: white; font-size: 1.5rem; cursor: pointer; margin-right: 15px; }
        @media (max-width: 768px) {
            .sidebar { position: fixed; left: -280px; height: 100vh; margin: 0; border-radius: 0; }
            .sidebar.open { left: 0; box-shadow: 10px 0 30px rgba(0,0,0,0.3); }
            .menu-toggle { display: block; }
            .main { padding: 15px; }
            .grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>

    <div id="login-overlay" class="overlay-screen active" style="z-index: 2000;">
        <div class="modal-box glass" style="background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.3); color: white; text-align: center;">
            <h1 style="margin-bottom: 5px;">Link Space ü™ê</h1>
            <p style="margin-bottom: 25px; opacity: 0.8;">Kho l∆∞u tr·ªØ v≈© tr·ª• c·ªßa b·∫°n</p>
            <input type="text" id="u" class="inp-control" placeholder="T√™n ƒëƒÉng nh·∫≠p" style="background:rgba(255,255,255,0.2); border:none; color:white; margin-bottom:10px;">
            <input type="password" id="p" class="inp-control" placeholder="M·∫≠t kh·∫©u" style="background:rgba(255,255,255,0.2); border:none; color:white; margin-bottom:20px;">
            <button class="btn-primary" onclick="app.login()">Kh·ªüi ƒë·ªông t√†u v≈© tr·ª• üöÄ</button>
            <p id="login-msg" style="color:#ff6b81; margin-top:10px; font-size:0.9rem"></p>
        </div>
    </div>

    <div class="sidebar glass" id="sidebar">
        <div class="brand"><i class="fas fa-meteor"></i> Link Space</div>
        
        <div id="menu-list">
            <div class="menu-item active" onclick="app.filter('all', this)"><i class="fas fa-globe"></i> T·∫•t c·∫£</div>
            <div class="menu-item" onclick="app.filter('C√¥ng vi·ªác', this)"><i class="fas fa-briefcase"></i> C√¥ng vi·ªác</div>
            <div class="menu-item" onclick="app.filter('H·ªçc t·∫≠p', this)"><i class="fas fa-book"></i> H·ªçc t·∫≠p</div>
            <div class="menu-item" onclick="app.filter('Gi·∫£i tr√≠', this)"><i class="fas fa-gamepad"></i> Gi·∫£i tr√≠</div>
            <div class="menu-item" onclick="app.filter('T√†i li·ªáu', this)"><i class="fas fa-folder"></i> T√†i li·ªáu</div>
            <div class="menu-item" onclick="app.filter('Kh√°c', this)"><i class="fas fa-star"></i> Kh√°c</div>
        </div>

        <div class="user-panel">
            <div style="display:flex; align-items:center; gap:10px">
                <div style="width:35px; height:35px; background:rgba(255,255,255,0.3); border-radius:50%; display:flex; align-items:center; justify-content:center"><i class="fas fa-user-astronaut"></i></div>
                <span id="user-display" style="font-weight:bold">Guest</span>
            </div>
            <button onclick="location.reload()" style="background:none; border:none; color:#ff6b81; cursor:pointer"><i class="fas fa-power-off"></i></button>
        </div>
    </div>

    <div class="main">
        <div class="top-bar">
            <div style="display:flex; align-items:center;">
                <i class="fas fa-bars menu-toggle" onclick="document.getElementById('sidebar').classList.toggle('open')"></i>
                <div class="search-box">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" id="search-inp" placeholder="T√¨m ki·∫øm link..." onkeyup="app.search()">
                </div>
            </div>
            <button class="btn-add" onclick="app.openModal()"><i class="fas fa-plus"></i> Th√™m m·ªõi</button>
        </div>

        <div class="grid" id="grid">
            </div>
    </div>

    <div id="modal-overlay" class="overlay-screen">
        <div class="modal-box">
            <h2 id="modal-title" style="margin-top:0; color: #333;">Th√™m Link M·ªõi</h2>
            
            <div class="inp-group" style="display:flex; gap:10px">
                <input type="text" id="inp-url" class="inp-control" placeholder="D√°n URL (https://...)" onchange="app.fetchMeta()">
                <button onclick="app.fetchMeta()" class="btn-primary" style="width:50px; display:flex; align-items:center; justify-content:center">‚ö°</button>
            </div>
            <div class="inp-group"><input type="text" id="inp-title" class="inp-control" placeholder="Ti√™u ƒë·ªÅ"></div>
            <div class="inp-group">
                <select id="inp-cate" class="inp-control">
                    <option value="C√¥ng vi·ªác">üíº C√¥ng vi·ªác</option>
                    <option value="H·ªçc t·∫≠p">üìö H·ªçc t·∫≠p</option>
                    <option value="Gi·∫£i tr√≠">üé¨ Gi·∫£i tr√≠</option>
                    <option value="T√†i li·ªáu">üìÇ T√†i li·ªáu</option>
                    <option value="Kh√°c">‚ú® Kh√°c</option>
                </select>
            </div>
            <div class="inp-group"><textarea id="inp-desc" class="inp-control" rows="3" placeholder="M√¥ t·∫£..."></textarea></div>

            <input type="hidden" id="inp-icon">
            <input type="hidden" id="inp-row">

            <div style="display:flex; justify-content:flex-end; gap:10px; margin-top:20px;">
                <button onclick="document.getElementById('modal-overlay').classList.remove('active')" style="background:#eee; color:#333; padding:10px 20px; border:none; border-radius:8px; cursor:pointer">H·ªßy</button>
                <button onclick="app.saveLink()" id="btn-save" class="btn-primary" style="width:auto">L∆∞u l·∫°i</button>
            </div>
        </div>
    </div>

    <div id="toast"><i class="fas fa-check-circle" style="color:#2ecc71"></i> <span id="toast-msg">Th√†nh c√¥ng</span></div>

    <script>
        // --- D√ÅN URL API C·ª¶A B·∫†N V√ÄO D∆Ø·ªöI ƒê√ÇY ---
        const API = 'https://script.google.com/macros/s/AKfycbzNix_roJMywRXJHqwNftO0eu86h9i6ZJlPdwkpbE_j3_PA4-EubIF_1lhhJGrRKg8K/exec'; 

        const app = {
            data: [], userMDD: '', isEdit: false,

            login: function() {
                const u = document.getElementById('u').value, p = document.getElementById('p').value;
                const btn = document.querySelector('#login-overlay button');
                btn.innerText = "ƒêang k·∫øt n·ªëi..."; btn.disabled = true;

                const fd = new FormData(); fd.append('action', 'login'); fd.append('user', u); fd.append('pass', p);
                fetch(API, {method:'POST', body:fd}).then(r=>r.json()).then(res=>{
                    if(res.status=='success'){
                        this.userMDD = res.mdd;
                        document.getElementById('user-display').innerText = u;
                        document.getElementById('login-overlay').classList.remove('active');
                        this.loadLinks();
                    } else {
                        document.getElementById('login-msg').innerText = "Sai th√¥ng tin ƒëƒÉng nh·∫≠p!";
                        btn.innerText = "Kh·ªüi ƒë·ªông t√†u v≈© tr·ª• üöÄ"; btn.disabled = false;
                    }
                }).catch(()=> { btn.disabled = false; alert("L·ªói k·∫øt n·ªëi Server"); });
            },

            loadLinks: function() {
                document.getElementById('grid').innerHTML = '<p style="text-align:center; width:100%; color:white; font-size:1.2rem">ƒêang t·∫£i d·ªØ li·ªáu t·ª´ v≈© tr·ª•...</p>';
                fetch(API + '?action=getLinks&mdd=' + this.userMDD).then(r=>r.json()).then(res=>{
                    this.data = res; this.render(this.data);
                });
            },

            render: function(list) {
                const grid = document.getElementById('grid'); grid.innerHTML = "";
                if(list.length==0) { grid.innerHTML = '<p style="text-align:center; width:100%">Ch∆∞a c√≥ link n√†o.</p>'; return;}
                
                list.forEach(i => {
                    // i: [0]Time, [1]Title, [2]Url, [3]Cate, [4]Stat, [5]MDD, [6]Desc, [7]Icon, [8]Row
                    const icon = i[7] || "https://cdn-icons-png.flaticon.com/512/1006/1006771.png";
                    grid.innerHTML += `
                        <div class="card glass">
                            <div class="card-header">
                                <img src="${icon}" class="card-icon" onerror="this.src='https://cdn-icons-png.flaticon.com/512/1006/1006771.png'">
                                <div style="flex:1; overflow:hidden">
                                    <div class="card-title" title="${i[1]}">${i[1]}</div>
                                    <span class="card-tag">${i[3]}</span>
                                </div>
                            </div>
                            <div class="card-desc">${i[6]}</div>
                            <div class="card-actions">
                                <div>
                                    <a href="${i[2]}" target="_blank" class="action-btn" title="M·ªü"><i class="fas fa-external-link-alt"></i></a>
                                </div>
                                <div style="display:flex; gap:5px">
                                    <button onclick="app.copyLink('${i[2]}')" class="action-btn" title="Copy"><i class="fas fa-copy"></i></button>
                                    <button onclick="app.editModal(${i[8]})" class="action-btn" title="S·ª≠a"><i class="fas fa-pen"></i></button>
                                    <button onclick="app.deleteLink(${i[8]})" class="action-btn del" title="X√≥a"><i class="fas fa-trash"></i></button>
                                </div>
                            </div>
                        </div>
                    `;
                });
            },

            filter: function(c, el) {
                document.querySelectorAll('.menu-item').forEach(e=>e.classList.remove('active'));
                el.classList.add('active');
                this.render(c=='all' ? this.data : this.data.filter(x=>x[3]==c));
            },

            search: function() {
                const k = document.getElementById('search-inp').value.toLowerCase();
                this.render(this.data.filter(x => String(x[1]).toLowerCase().includes(k) || String(x[2]).toLowerCase().includes(k)));
            },

            openModal: function() {
                this.isEdit = false;
                document.getElementById('modal-title').innerText = "Th√™m Link M·ªõi";
                ['inp-url','inp-title','inp-desc','inp-icon'].forEach(id=>document.getElementById(id).value="");
                document.getElementById('modal-overlay').classList.add('active');
            },

            editModal: function(row) {
                const item = this.data.find(x=>x[8]==row);
                if(!item) return;
                this.isEdit = true;
                document.getElementById('modal-title').innerText = "C·∫≠p Nh·∫≠t Link";
                document.getElementById('inp-row').value = row;
                document.getElementById('inp-title').value = item[1];
                document.getElementById('inp-url').value = item[2];
                document.getElementById('inp-cate').value = item[3];
                document.getElementById('inp-desc').value = item[6];
                document.getElementById('inp-icon').value = item[7];
                document.getElementById('modal-overlay').classList.add('active');
            },

            fetchMeta: function() {
                const url = document.getElementById('inp-url').value;
                if(url.length < 5) return;
                const btn = document.querySelector('.inp-group button');
                btn.innerHTML = "<i class='fas fa-spinner fa-spin'></i>";
                
                const fd = new FormData(); fd.append('action', 'fetchMeta'); fd.append('url', url);
                fetch(API, {method:'POST', body:fd}).then(r=>r.json()).then(res=>{
                    btn.innerHTML = "‚ö°";
                    if(res.status=='success'){
                        document.getElementById('inp-title').value = res.title;
                        document.getElementById('inp-desc').value = res.description;
                        document.getElementById('inp-icon').value = res.icon;
                        this.toast("ƒê√£ l·∫•y th√¥ng tin!");
                    }
                });
            },

            saveLink: function() {
                const u = document.getElementById('inp-url').value, t = document.getElementById('inp-title').value;
                if(!u || !t) return alert("Thi·∫øu URL ho·∫∑c Ti√™u ƒë·ªÅ");
                
                const btn = document.getElementById('btn-save'); btn.innerText = "L∆∞u..."; btn.disabled = true;
                const fd = new FormData();
                fd.append('mdd', this.userMDD); fd.append('url', u); fd.append('title', t);
                fd.append('category', document.getElementById('inp-cate').value);
                fd.append('desc', document.getElementById('inp-desc').value);
                fd.append('icon', document.getElementById('inp-icon').value);
                
                if(this.isEdit) { fd.append('action', 'editLink'); fd.append('row', document.getElementById('inp-row').value); }
                else fd.append('action', 'addLink');

                fetch(API, {method:'POST', body:fd}).then(()=>{
                    this.toast("ƒê√£ l∆∞u th√†nh c√¥ng!");
                    document.getElementById('modal-overlay').classList.remove('active');
                    btn.innerText = "L∆∞u l·∫°i"; btn.disabled = false;
                    this.loadLinks();
                });
            },

            deleteLink: function(r) {
                if(!confirm("X√≥a link n√†y?")) return;
                this.data = this.data.filter(x=>x[8]!=r); this.render(this.data); // Optimistic update
                const fd = new FormData(); fd.append('action', 'deleteLink'); fd.append('row', r);
                fetch(API, {method:'POST', body:fd});
                this.toast("ƒê√£ x√≥a link");
            },

            copyLink: function(t) { navigator.clipboard.writeText(t); this.toast("ƒê√£ copy link!"); },

            toast: function(m) {
                const t = document.getElementById('toast');
                document.getElementById('toast-msg').innerText = m;
                t.classList.add('show'); setTimeout(()=>t.classList.remove('show'), 3000);
            }
        };
    </script>
</body>
</html>
