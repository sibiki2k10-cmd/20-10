<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Private Links üîí</title>
    <style>
        :root { --primary: #0984e3; --bg: #f5f6fa; --card: #fff; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; padding: 20px; display: flex; justify-content: center; }
        .container { width: 100%; max-width: 600px; }
        
        /* Login Form */
        #login-screen { background: var(--card); padding: 40px; border-radius: 10px; text-align: center; box-shadow: 0 4px 15px rgba(0,0,0,0.1); margin-top: 50px; }
        
        /* Dashboard */
        .hidden { display: none; }
        .input-group { background: var(--card); padding: 20px; border-radius: 10px; margin-bottom: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        
        input, select { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #dcdde1; border-radius: 6px; box-sizing: border-box; }
        button { width: 100%; padding: 12px; background: var(--primary); color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; }
        button:hover { opacity: 0.9; }
        
        /* User Info Bar */
        .user-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; font-weight: bold; color: #2d3436; }
        
        /* Link Card */
        .link-card { background: var(--card); padding: 15px; margin-bottom: 10px; border-radius: 8px; border-left: 5px solid var(--primary); display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .link-info h3 { margin: 0 0 5px 0; font-size: 1.1rem; color: #2d3436; }
        .link-meta { font-size: 0.85rem; color: #636e72; }
        .tag { background: #dfe6e9; padding: 2px 8px; border-radius: 4px; font-size: 0.8rem; color: #2d3436; margin-right: 5px; }
        
        .actions a { text-decoration: none; background: #00b894; color: white; padding: 5px 10px; border-radius: 4px; font-size: 0.9rem; margin-right: 5px; }
        .btn-del { background: #fab1a0; color: #d63031; padding: 5px 10px; border-radius: 4px; cursor: pointer; border: none; }
    </style>
</head>
<body>

    <div class="container">
        <div id="login-screen">
            <h2>üîê Private Link Saver</h2>
            <input type="text" id="user" placeholder="Username">
            <input type="password" id="pass" placeholder="Password">
            <button onclick="login()">ƒêƒÉng nh·∫≠p an to√†n</button>
            <p id="msg" style="color:red; margin-top:10px"></p>
        </div>

        <div id="app" class="hidden">
            <div class="user-bar">
                <span id="welcome-msg">Xin ch√†o!</span>
                <button onclick="logout()" style="width: auto; padding: 5px 10px; background: #636e72;">Tho√°t</button>
            </div>

            <div class="input-group">
                <h3>Th√™m Link M·ªõi</h3>
                <input type="text" id="linkTitle" placeholder="Ti√™u ƒë·ªÅ trang web">
                <input type="url" id="linkUrl" placeholder="D√°n URL v√†o ƒë√¢y (https://...)">
                <select id="linkCategory">
                    <option value="C√¥ng vi·ªác">üíº C√¥ng vi·ªác</option>
                    <option value="H·ªçc t·∫≠p">üìö H·ªçc t·∫≠p</option>
                    <option value="Gi·∫£i tr√≠">üé¨ Gi·∫£i tr√≠</option>
                    <option value="Kh√°c">‚ú® Kh√°c</option>
                </select>
                <button onclick="addLink()">üíæ L∆∞u v√†o kho c·ªßa t√¥i</button>
            </div>

            <div id="link-list">
                <p style="text-align:center">ƒêang t·∫£i d·ªØ li·ªáu...</p>
            </div>
        </div>
    </div>

    <script>
        // --- C·∫§U H√åNH: D√ÅN LINK SCRIPT V√ÄO ƒê√ÇY ---
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwmgOyiaXJOGMHX_pDIL0JHNcJJrl876pR4ltwhxxoUZaAl7P2gJtBEVxNcScn7lWbd/exec'; 

        // Bi·∫øn to√†n c·ª•c ƒë·ªÉ l∆∞u m√£ ƒë·ªãnh danh ng∆∞·ªùi d√πng hi·ªán t·∫°i
        let currentUserMDD = "";
        let currentUserName = "";

        function login() {
            const u = document.getElementById('user').value;
            const p = document.getElementById('pass').value;
            document.getElementById('msg').innerText = "ƒêang x√°c th·ª±c...";

            const fd = new FormData();
            fd.append('action', 'login');
            fd.append('user', u);
            fd.append('pass', p);

            fetch(SCRIPT_URL, { method: 'POST', body: fd })
            .then(res => res.json())
            .then(data => {
                if(data.status == 'success') {
                    // L∆ØU MDD V√ÄO BI·∫æN
                    currentUserMDD = data.mdd;
                    currentUserName = u;
                    
                    document.getElementById('welcome-msg').innerText = "üë§ " + currentUserName;
                    document.getElementById('login-screen').classList.add('hidden');
                    document.getElementById('app').classList.remove('hidden');
                    
                    // T·∫£i danh s√°ch c·ªßa ri√™ng user n√†y
                    loadLinks();
                } else {
                    document.getElementById('msg').innerText = "Sai t√†i kho·∫£n ho·∫∑c m·∫≠t kh·∫©u!";
                }
            });
        }

        function addLink() {
            const title = document.getElementById('linkTitle').value;
            const url = document.getElementById('linkUrl').value;
            const cate = document.getElementById('linkCategory').value;

            if(!title || !url) return alert("Vui l√≤ng nh·∫≠p ƒë·ªß th√¥ng tin!");

            const btn = document.querySelector('button[onclick="addLink()"]');
            btn.innerText = "ƒêang m√£ h√≥a & l∆∞u...";
            btn.disabled = true;

            const fd = new FormData();
            fd.append('action', 'addLink');
            fd.append('title', title);
            fd.append('url', url);
            fd.append('category', cate);
            // QUAN TR·ªåNG: G·ª≠i k√®m MDD ƒë·ªÉ Server bi·∫øt link n√†y c·ªßa ai
            fd.append('mdd', currentUserMDD); 

            fetch(SCRIPT_URL, { method: 'POST', body: fd })
            .then(() => {
                alert("ƒê√£ l∆∞u th√†nh c√¥ng!");
                document.getElementById('linkTitle').value = "";
                document.getElementById('linkUrl').value = "";
                btn.innerText = "üíæ L∆∞u v√†o kho c·ªßa t√¥i";
                btn.disabled = false;
                loadLinks();
            });
        }

        function loadLinks() {
            // G·ª≠i k√®m MDD l√™n Server ƒë·ªÉ l·ªçc d·ªØ li·ªáu
            fetch(SCRIPT_URL + '?action=getLinks&mdd=' + currentUserMDD)
            .then(res => res.json())
            .then(data => {
                const list = document.getElementById('link-list');
                list.innerHTML = "";
                
                if(data.length === 0) return list.innerHTML = "<p style='text-align:center; color:#888'>Kho c·ªßa b·∫°n ƒëang tr·ªëng.</p>";

                data.forEach(row => {
                    // row[6] l√† s·ªë d√≤ng (rowIndex) ƒë√£ ƒë∆∞·ª£c th√™m ·ªü server
                    list.innerHTML += `
                        <div class="link-card">
                            <div class="link-info">
                                <h3>${row[1]}</h3>
                                <div class="link-meta">
                                    <span class="tag">${row[3]}</span> 
                                    ${new Date(row[0]).toLocaleDateString()}
                                </div>
                            </div>
                            <div class="actions">
                                <a href="${row[2]}" target="_blank">M·ªü ‚Üó</a>
                                <button class="btn-del" onclick="deleteLink(${row[6]})">X√≥a</button>
                            </div>
                        </div>
                    `;
                });
            });
        }

        function deleteLink(rowIndex) {
            if(!confirm("X√≥a vƒ©nh vi·ªÖn link n√†y?")) return;
            
            const fd = new FormData();
            fd.append('action', 'deleteLink');
            fd.append('row', rowIndex);

            fetch(SCRIPT_URL, { method: 'POST', body: fd })
            .then(() => loadLinks());
        }

        function logout() {
            location.reload();
        }
    </script>

</body>
</html>
