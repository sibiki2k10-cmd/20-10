<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel | 20-10</title>
    <style>
        body { font-family: monospace; background: #111; color: #0f0; padding: 20px; }
        .container { max-width: 600px; margin: 0 auto; }
        
        /* Login CSS */
        #login-screen { text-align: center; margin-top: 100px; border: 1px solid #333; padding: 40px; border-radius: 10px; }
        input { background: #222; border: 1px solid #444; color: white; padding: 10px; margin: 5px; width: 80%; }
        button.login-btn { background: #0f0; color: black; border: none; padding: 10px 20px; cursor: pointer; font-weight: bold; margin-top: 10px; }

        /* Dashboard CSS */
        .msg-card { 
            background: #1a1a1a; border: 1px solid #333; margin-bottom: 15px; 
            padding: 15px; border-radius: 4px; position: relative;
        }
        .meta { color: #888; font-size: 0.8rem; margin-bottom: 5px; display: flex; justify-content: space-between; }
        .content { font-size: 1.1rem; color: #eee; white-space: pre-wrap; margin-right: 40px; }
        .hidden { display: none; }

        /* NÃºt XÃ³a */
        .btn-delete {
            position: absolute; top: 10px; right: 10px;
            background: transparent; border: 1px solid #d9534f; color: #d9534f;
            padding: 5px 10px; cursor: pointer; border-radius: 3px;
        }
        .btn-delete:hover { background: #d9534f; color: white; }
    </style>
</head>
<body>

    <div class="container">
        <div id="login-screen">
            <h2>SYSTEM ACCESS</h2>
            <input type="text" id="user" placeholder="Username">
            <input type="password" id="pass" placeholder="Password">
            <br>
            <button class="login-btn" onclick="login()">LOGIN</button>
            <p id="status" style="color:red; margin-top:10px"></p>
        </div>

        <div id="dashboard" class="hidden">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                <h2>ðŸ“¨ INBOX MESSAGES</h2>
                <button onclick="logout()" style="background:#d9534f; color:white; border:none; padding:5px 10px; cursor:pointer">LOGOUT</button>
            </div>
            
            <button onclick="loadData()" style="cursor:pointer; padding:5px;">ðŸ”„ Refresh Data</button>
            <div id="list" style="margin-top:20px">Loading...</div>
        </div>
    </div>

    <script>
        // --- DÃN LINK SCRIPT Cá»¦A Báº N VÃ€O ÄÃ‚Y ---
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyw5RNtf8-GLLeAnGC2NrtpoJhHGiHBvgGji986GvqmDQhgJjgdoq7PiywfqxiCY0il/exec'; 

        function login() {
            const u = document.getElementById('user').value;
            const p = document.getElementById('pass').value;
            const status = document.getElementById('status');
            
            status.innerText = "Authenticating...";

            const formData = new FormData();
            formData.append('action', 'login');
            formData.append('user', u);
            formData.append('pass', p);

            fetch(SCRIPT_URL, { method: 'POST', body: formData })
            .then(res => res.json())
            .then(data => {
                if(data.status == 'success') {
                    document.getElementById('login-screen').classList.add('hidden');
                    document.getElementById('dashboard').classList.remove('hidden');
                    loadData();
                } else {
                    status.innerText = "âŒ Access Denied";
                }
            });
        }

        function loadData() {
            document.getElementById('list').innerHTML = "Äang táº£i...";
            fetch(SCRIPT_URL + '?action=getMessages')
            .then(res => res.json())
            .then(data => {
                const list = document.getElementById('list');
                list.innerHTML = "";
                if(data.length === 0) {
                    list.innerHTML = "KhÃ´ng cÃ³ tin nháº¯n nÃ o.";
                    return;
                }
                data.forEach(row => {
                    // row[0]=Time, row[1]=Name, row[2]=Msg, row[3]=Status, row[4]=RowIndex (Sá»‘ dÃ²ng)
                    const rowIndex = row[4]; 
                    
                    list.innerHTML += `
                        <div class="msg-card" id="card-${rowIndex}">
                            <div class="meta">
                                <span>FROM: <b style="color:#ff69b4">${row[1]}</b></span>
                                <span>${row[0]}</span>
                            </div>
                            <div class="content">${row[2]}</div>
                            <button class="btn-delete" onclick="deleteMsg(${rowIndex})">XÃ“A</button>
                        </div>
                    `;
                });
            });
        }

        function deleteMsg(rowIndex) {
            if(!confirm("Báº¡n cÃ³ cháº¯c cháº¯n muá»‘n xÃ³a tin nháº¯n nÃ y khÃ´ng?")) return;

            // Hiá»‡u á»©ng má» Ä‘i Ä‘á»ƒ biáº¿t Ä‘ang xá»­ lÃ½
            const card = document.getElementById(`card-${rowIndex}`);
            card.style.opacity = "0.5";

            const formData = new FormData();
            formData.append('action', 'deleteMessage');
            formData.append('row', rowIndex);

            fetch(SCRIPT_URL, { method: 'POST', body: formData })
            .then(() => {
                // XÃ³a thÃ nh cÃ´ng thÃ¬ áº©n luÃ´n cÃ¡i tháº» Ä‘Ã³ Ä‘i
                card.remove(); 
            })
            .catch(err => {
                alert("Lá»—i khi xÃ³a!");
                card.style.opacity = "1";
            });
        }

        function logout() { location.reload(); }
    </script>
</body>
</html>
